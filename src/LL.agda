
module LL where

open import Prelude hiding (_&_ ; Â¬_ ; _âˆ) renaming (âŠ¥ to Void ; âŠ¤ to Unit)

infixr 8 _&_ _âŠ—_
infixr 7 _â…‹_ _âŠ•_
data U : Set where
  ğŸ˜ ğŸ™ : U
  âŠ¤ âŠ¥ : U
  Â¬_  : U â†’ U
  _&_ _â…‹_ : (A B : U) â†’ U
  _âŠ—_ _âŠ•_ : (A B : U) â†’ U

_â»Â¹ : U â†’ U
ğŸ˜ â»Â¹ = âŠ¤
ğŸ™ â»Â¹ = âŠ¥
âŠ¤ â»Â¹ = ğŸ˜
âŠ¥ â»Â¹ = ğŸ™
(Â¬ A) â»Â¹ = A
(A & B) â»Â¹ = A â»Â¹ âŠ• B â»Â¹
(A â…‹ B) â»Â¹ = A â»Â¹ âŠ— B â»Â¹
(A âŠ— B) â»Â¹ = A â»Â¹ â…‹ B â»Â¹
(A âŠ• B) â»Â¹ = A â»Â¹ & B â»Â¹

replace : âˆ€ {a} {A : Set a} â†’ Nat â†’ A Ã— List A â†’ A Ã— List A
replace i       (x , []     ) = x , []
replace zero    (x , xâ‚ âˆ· xs) = xâ‚ , x âˆ· xs
replace (suc i) (x , xâ‚ âˆ· xs) = second (_âˆ·_ xâ‚) (replace i (x , xs))

-- replace-inv : âˆ€ {a} {A : Set a} (i : Nat) {x : A} {xs : List A} â†’ replace i (replace i (x , xs)) â‰¡ (x , xs)

swap : âˆ€ {a} {A : Set a} â†’ Nat Ã— Nat â†’ List A â†’ List A
swap (i , j) []               = []
swap (zero , zero)   xs       = xs
swap (zero , suc j)  (x âˆ· xs) = uncurry _âˆ·_ (replace j (x , xs))
swap (suc i , zero)  (x âˆ· xs) = uncurry _âˆ·_ (replace i (x , xs))
swap (suc i , suc j) (x âˆ· xs) = x âˆ· swap (i , j) xs

Permutation : Set
Permutation = List (Nat Ã— Nat)

permute : âˆ€ {a} {A : Set a} â†’ Permutation â†’ List A â†’ List A
permute = foldr (Î» ij k â†’ swap ij âˆ˜ k) id

infix 4 _â‰¡_âŠ_

data _â‰¡_âŠ_ {a} {A : Set a} : List A â†’ List A â†’ List A â†’ Set a where
  âˆ  : [] â‰¡ [] âŠ []
  â—‚_ : âˆ€ {x xs ls rs}
     â†’     xs â‰¡     ls âŠ rs
     â†’ x âˆ· xs â‰¡ x âˆ· ls âŠ rs
  â–¸_ : âˆ€ {x xs ls rs}
     â†’     xs â‰¡ ls âŠ     rs
     â†’ x âˆ· xs â‰¡ ls âŠ x âˆ· rs

infix 4 _âŠ¢_
data _âŠ¢_ : List U â†’ List U â†’ Set where
  init : âˆ€ {A}
       â†’ [ A ] âŠ¢ [ A ]
  Â¬L : âˆ€ {A Î” Î“ Î“'}
     â†’ Î“' â‰¡ [ A ] âŠ Î“
     â†’ Î” âŠ¢ Î“'
     â†’ Â¬ A âˆ· Î” âŠ¢ Î“
  Â¬R : âˆ€ {A Î” Î”' Î“}
     â†’ Î”' â‰¡ [ A ] âŠ Î”
     â†’ Î”' âŠ¢ Î“
     â†’ Î” âŠ¢ Â¬ A âˆ· Î“
  ğŸ™L : âˆ€ {Î” Î“}
     â†’ Î” âŠ¢ Î“
     â†’ ğŸ™ âˆ· Î” âŠ¢ Î“
  ğŸ™R : [] âŠ¢ [ ğŸ™ ]
  âŠ—L : âˆ€ {A B Î” Î”' Î“}
     â†’ Î” â‰¡ (A âˆ· B âˆ· []) âŠ Î”
     â†’ Î”' âŠ¢ Î“
     â†’ A âŠ— B âˆ· Î” âŠ¢ Î“
  âŠ—R : âˆ€ {A B Î” Î”â‚ Î”â‚‚ Î“ Î“â‚ Î“â‚‚ Î“â‚' Î“â‚‚'}
     â†’ Î” â‰¡ Î”â‚ âŠ Î”â‚‚
     â†’ Î“ â‰¡ Î“â‚ âŠ Î“â‚‚
     â†’ Î“â‚' â‰¡ [ A ] âŠ Î“â‚
     â†’ Î“â‚‚' â‰¡ [ B ] âŠ Î“â‚‚
     â†’ Î”â‚ âŠ¢ Î“â‚'
     â†’ Î”â‚‚ âŠ¢ Î“â‚‚'
     â†’ Î” âŠ¢ A âŠ— B âˆ· Î“
  â…‹L : âˆ€ {A B Î” Î”â‚ Î”â‚‚ Î”â‚' Î”â‚‚' Î“ Î“â‚ Î“â‚‚}
     â†’ Î” â‰¡ Î”â‚ âŠ Î”â‚‚
     â†’ Î“ â‰¡ Î“â‚ âŠ Î“â‚‚
     â†’ Î”â‚' â‰¡ [ A ] âŠ Î”â‚
     â†’ Î”â‚‚' â‰¡ [ B ] âŠ Î”â‚‚
     â†’ Î”â‚' âŠ¢ Î“â‚
     â†’ Î”â‚‚' âŠ¢ Î“â‚‚
     â†’ A â…‹ B âˆ· Î” âŠ¢ Î“
  â…‹R : âˆ€ {A B Î” Î“ Î“'}
     â†’ Î“' â‰¡ (A âˆ· B âˆ· []) âŠ Î“
     â†’ Î” âŠ¢ Î“'
     â†’ Î” âŠ¢ A â…‹ B âˆ· Î“
  âŠ¥L : [ âŠ¥ ] âŠ¢ []
  âŠ¥R : âˆ€ {Î” Î“}
     â†’ Î” âŠ¢ Î“
     â†’ Î” âŠ¢ âŠ¥ âˆ· Î“
  ğŸ˜L : âˆ€ {Î” Î“}
     â†’ ğŸ˜ âˆ· Î” âŠ¢ Î“
  âŠ¤R : âˆ€ {Î” Î“}
     â†’ Î” âŠ¢ âŠ¤ âˆ· Î“
  &Lâ‚ : âˆ€ {A B Î” Î”' Î“}
      â†’ Î”' â‰¡ [ A ] âŠ Î”
      â†’ Î”' âŠ¢ Î“
      â†’ A & B âˆ· Î” âŠ¢ Î“
  &Lâ‚‚ : âˆ€ {A B Î” Î”' Î“}
      â†’ Î”' â‰¡ [ B ] âŠ Î”
      â†’ Î”' âŠ¢ Î“
      â†’ A & B âˆ· Î” âŠ¢ Î“
  &R : âˆ€ {A B Î” Î“}
     â†’ Î” âŠ¢ A âˆ· Î“
     â†’ Î” âŠ¢ B âˆ· Î“
     â†’ Î” âŠ¢ A & B âˆ· Î“
  âŠ•L : âˆ€ {A B Î” Î”' Î”'' Î“}
     â†’ Î”'  â‰¡ [ A ] âŠ Î”
     â†’ Î”'' â‰¡ [ B ] âŠ Î”
     â†’ A âˆ· Î” âŠ¢ Î“
     â†’ B âˆ· Î” âŠ¢ Î“
     â†’ A âŠ• B âˆ· Î” âŠ¢ Î“
  âŠ•Râ‚ : âˆ€ {A B Î” Î“ Î“'}
      â†’ Î“' â‰¡ [ A ] âŠ Î“
      â†’ Î” âŠ¢ Î“'
      â†’ Î” âŠ¢ A & B âˆ· Î“
  âŠ•Râ‚‚ : âˆ€ {A B Î” Î“ Î“'}
      â†’ Î“' â‰¡ [ B ] âŠ Î“
      â†’ Î” âŠ¢ Î“'
      â†’ Î” âŠ¢ A & B âˆ· Î“

infix 4 _âŠ¸_
pattern _âŠ¸_ A B = Â¬ A â…‹ B

pâ‚ : âˆ€ {A B} â†’ [] âŠ¢ [ ((A âŠ¸ B) âŠ¸ ğŸ˜) âŠ¸ (A âŠ— âŠ¤) ]
pâ‚ =
  â…‹R (â—‚ â—‚ âˆ)
  $ Â¬R (â—‚ âˆ)
  $ â…‹L âˆ (â—‚ âˆ) (â—‚ âˆ) (â—‚ âˆ)
    (Â¬L (â—‚ â–¸ âˆ)
    $ â…‹R (â—‚ â–¸ â—‚ âˆ)
    $ Â¬R (â—‚ âˆ)
    $ âŠ—R (â—‚ âˆ) (â–¸ âˆ) (â—‚ âˆ) (â—‚ â–¸ âˆ)
      init
      âŠ¤R
    )
    ğŸ˜L
